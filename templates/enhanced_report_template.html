<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        /* Base page settings */
        @page {
            size: A4;
            margin: 2cm;
            @top-center {
                content: string(chapter);
                font-size: 9pt;
                color: #444;
                padding-top: 0.5cm;
                font-family: "Noto Sans", Arial, sans-serif;
            }
            @bottom-center {
                content: counter(page);
                font-size: 9pt;
                color: #444;
                padding-bottom: 0.5cm;
                font-family: "Noto Sans", Arial, sans-serif;
            }
        }
        
        /* Special pages */
        @page :first {
            margin: 0;
            @top-center { content: none; }
            @bottom-center { content: none; }
        }
        
        @page cover {
            margin: 0;
            @top-center { content: none; }
            @bottom-center { content: none; }
        }
        
        @page section-cover {
            margin: 0;
            @top-center { content: none; }
            @bottom-center { content: none; }
        }
        
        @page toc {
            @top-center { content: none; }
        }
        
        /* Base styles */
        body {
            font-family: "Noto Sans", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            font-size: 10.5pt;
            margin: 0;
            padding: 0;
            counter-reset: section subsection figure-counter table-counter;
        }
        
        /* Cover page styles */
        .cover {
            page: cover;
            min-height: 297mm;
            box-sizing: border-box;
            padding: 2cm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        .cover h1 {
            font-size: 36pt;
            margin-bottom: 1em;
            color: #1a1a1a;
        }
        .cover h2 {
            font-size: 24pt;
            margin-bottom: 2em;
            color: #444;
        }
        .cover p {
            font-size: 12pt;
            color: #666;
            margin: 0.5em 0;
        }
        
        /* Section cover page */
        .section-cover {
            page: section-cover;
            min-height: 297mm;
            box-sizing: border-box;
            padding: 3cm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            page-break-before: always;
            page-break-after: always;
        }
        .section-cover h2 {
            font-size: 32pt;
            margin-bottom: 1em;
            color: #1a1a1a;
            border-bottom: 4px solid #444;
            padding-bottom: 0.2em;
            width: 100%;
        }
        .section-intro {
            font-size: 12pt;
            color: #444;
            margin: 2em 0;
            max-width: 80%;
            line-height: 1.8;
        }
        .section-meta {
            margin-top: 3em;
            padding: 1em;
            background: #f8f9fa;
            border-radius: 8px;
            width: 100%;
        }
        .meta-item {
            margin: 0.5em 0;
            color: #666;
            font-size: 11pt;
        }
        .meta-item strong {
            color: #444;
        }
        
        /* TOC styles */
        .toc {
            page: toc;
            page-break-after: always;
            padding-top: 2cm;
        }
        .toc h1 {
            font-size: 24pt;
            margin-bottom: 2em;
            color: #1a1a1a;
            text-align: center;
        }
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        .toc ul ul {
            padding-left: 2em;
        }
        .toc li {
            margin: 0.8em 0;
            padding-left: 1em;
        }
        .toc a {
            color: #333;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .toc a::after {
            content: target-counter(attr(href), page);
            color: #666;
            margin-left: 0.5em;
        }
        .toc .section-number {
            color: #666;
            margin-right: 0.5em;
        }
        
        /* Content section styles */
        .content-section {
            margin-top: 2cm;
        }
        .content-section h2 {
            font-size: 18pt;
            margin-top: 2em;
            margin-bottom: 1em;
            color: #1a1a1a;
            counter-increment: section;
        }
        .content-section h3 {
            font-size: 16pt;
            color: #1a1a1a;
            margin-top: 1.5em;
            margin-bottom: 1em;
            counter-increment: subsection;
        }
        .content-section h3::before {
            content: counter(section) "." counter(subsection) " ";
            color: #666;
        }
        
        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
            page-break-inside: avoid;
            font-size: 9.5pt;
        }
        thead {
            display: table-header-group;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px 12px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #f5f5f5;
            font-weight: bold;
            color: #333;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* Figures and Tables */
        figure {
            margin: 2em 0;
            page-break-inside: avoid;
            text-align: center;
        }
        figure img {
            max-width: 100%;
            height: auto;
        }
        figcaption {
            font-size: 0.9em;
            color: #666;
            margin-top: 0.5em;
            text-align: center;
        }
        figure.table {
            counter-increment: table-counter;
        }
        figure.table figcaption::before {
            content: "Table " counter(table-counter) ": ";
            font-weight: bold;
        }
        figure.image {
            counter-increment: figure-counter;
        }
        figure.image figcaption::before {
            content: "Figure " counter(figure-counter) ": ";
            font-weight: bold;
        }
        
        /* Code blocks */
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 1em;
            margin: 1.5em 0;
            font-family: "Courier New", monospace;
            font-size: 9pt;
            white-space: pre-wrap;
            word-wrap: break-word;
            page-break-inside: avoid;
            position: relative;
        }
        pre::before {
            content: attr(data-language);
            position: absolute;
            top: -0.7em;
            right: 1em;
            background: #fff;
            padding: 0 0.5em;
            color: #666;
            font-size: 0.8em;
            border: 1px solid #e9ecef;
            border-radius: 2px;
        }
        code {
            font-family: "Courier New", monospace;
            font-size: 0.9em;
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        /* Sources section */
        .sources {
            margin-top: 3em;
            padding-top: 1.5em;
            border-top: 2px solid #eee;
        }
        .sources h2 {
            font-size: 16pt;
            color: #444;
            margin-bottom: 1.5em;
            border-bottom: none;
        }
        .sources ul {
            list-style: none;
            padding-left: 0;
        }
        .sources li {
            margin: 1em 0;
            padding-left: 1.5em;
            position: relative;
        }
        .sources li::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #666;
        }
        .sources a {
            color: #0066cc;
            text-decoration: none;
        }
        
        /* End page */
        .end-page {
            page: cover;
            min-height: 297mm;
            box-sizing: border-box;
            padding: 2cm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #f8f9fa;
            page-break-before: always;
        }
        .end-page h2 {
            font-size: 24pt;
            color: #444;
            margin-bottom: 1em;
        }
        .end-page p {
            font-size: 12pt;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="cover">
        <h1>{{ company_name }}</h1>
        <h2>Company Analysis Report</h2>
        <p>Generated on: {{ generation_date }}</p>
        <p>Language: {{ language }}</p>
    </div>
    
    <div class="toc">
        <h1>Table of Contents</h1>
        {{ toc }}
    </div>
    
    {% for section in sections %}
    <div class="section-cover">
        <h2>{{ section.title }}</h2>
        <div class="section-intro">
            {{ section.intro }}
        </div>
        <div class="section-meta">
            <div class="meta-item">
                <strong>Estimated Reading Time:</strong> {{ section.reading_time }} minutes
            </div>
            <div class="meta-item">
                <strong>Key Topics:</strong> {{ section.key_topics }}
            </div>
            {% if section.key_takeaways %}
            <div class="meta-item">
                <strong>Key Takeaways:</strong>
                <ul>
                {% for takeaway in section.key_takeaways %}
                    <li>{{ takeaway }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
            {% if section.prerequisites %}
            <div class="meta-item">
                <strong>Prerequisites:</strong>
                <ul>
                {% for prereq in section.prerequisites %}
                    <li>{{ prereq }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
            {% if section.related_sections %}
            <div class="meta-item">
                <strong>Related Sections:</strong>
                <ul>
                {% for related in section.related_sections %}
                    <li>{{ related }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="content-section" id="section-{{ section.id }}">
        {{ section.content }}
    </div>
    {% endfor %}
    
    <div class="end-page">
        <h2>End of Report</h2>
        <p>Generated by Supervity Customer Research Agent</p>
        <p>{{ generation_date }}</p>
    </div>
</body>
</html>
